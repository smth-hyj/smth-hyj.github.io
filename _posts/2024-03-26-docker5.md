---
title: Linux 도커(5)
date: 2024-03-26 09:00:00 +09:00
categories: [국비, docker]
tags: [linux, container, docker, 리눅스, centos]		# TAG는 반드시 소문자로 이루어져야함!
---
# docker
## registry 구축
1. registry
    - 로컬 레지스트리
        - 전제 조건 (x)
    - 개인 레지스트리
        - 사내에 구성된 private registry
        - 클라우드에 구성된 private registry
        - 전제 조건
            - https 구성을 위한 인증서
            - 인증을 위한 구성
    - 공개 레지스트리
        - 전제 조건
            - https 구성을 위한 인증서
            - 인증을 위한 구성

2. 로컬 레지스트리 구성
    1. Docker engine
        - curl -fsSL https://get.docker.com -o get-docker.sh
        - sh ./get-docker.sh
        - systemctl enable --now docker

    2. Local registry 구성
        - docker run -d --name registry -p 5000:5000 registry

3. 개인 레지스트리 구성
    - 사내에 구성하는 rpviate registry
        1. 준비작업
            - 인증서 생성 & 배포
                - mkdir -p /auth && cd /auth
                - docker run --rm -v /auth:/auth alpine/openssl req -newkey rsa:4096 -nodes -sha256 -x509 -days 365 -keyout /auth/myregistry.com.key -out /auth/myregistry.com.crt -subj '/CN=myregistry.com' -addext "subjectAltName = DNS:myregistry.com"
                - (docker client) mkdir -p /etc/docker/certs.d/myregistry.com
                - (docker client) cp /auth/myregistry.com.crt /etc/docker/certs.d/myregistry.com/ca.crt
                - registry 서버에서도 도커 클라이언트에서 복사한 것처럼 해준다.

            - 인증을 위한 정보 생성

        2. private registry 구성
            - docker run -d -p 443:443 --restart=always --name registry -v /auth:/certs -v /image-data:/var/lib/registry -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/myregistry.com.crt -e REGISTRY_HTTP_TLS_KEY=/certs/myregistry.com.key -e REGISTRY_HTTP_ADDR=0.0.0.0:443 registry

    - 클라우드에 구성하는 private registry(ex: GCP(무료)) 

## Docker Compose
### 개요 및 설치