---
title: Linux 기초 (下)
date: 2024-03-01 20:00:00 +09:00
categories: [IT, 국비, linux]
tags: [linux, 환경설정, 리눅스, centos]		# TAG는 반드시 소문자로 이루어져야함!
---
# 리눅스 기초 
> *해당 내용은 수업에 사정이 있어서 난잡할 수 있다.*

### 사용자 정의 변수 및 환경 변수
env(환경변수 보는 법)  
PATH, TERM, EDITOR, ...
변수 선언 방법
export 변수=값
echo $변수 : 변수 확인
unset 변수 : 변수 해지

절대경로(Absolute path)
상대경로(Relative path)

PATH 변수 : 명령어를 검색할 디렉토리를 지정
export PATH=$PATH:$HOME/bin
=> 기존 PATH변수에 홈변수 추가

tail -f 파일 모니터링할 때 씀

su -c '명령어' 사용자 명령어 == sudo CMD: 루트권한으로 명령어 시행

sudo 'CMD'
sudo -l
sudo -i

- 검색 관련 명령어

```bash
grep option pattern CMD 
option : -i, --color, -n, -A, -l
pattern : *, ., ^root, root$, [abc] [a-c], [^a]
# find CMD
find / -name 이름 -type 타입
find / -user fedora -group fedora
find / -mtime -7|7|+7
find / -size --200M|200M|+200M
find / -permission
find / -name 이름 -type 타입 -exec CMD {} \;

# wc CMD
wc /etc/passwd 하면 
라인, 워드, 캐릭터 개수를 구할 수 있음
wc -l # (라인 카운트)
wc -w # (워드 카운트)
wc -c # (캐릭터 카운트)
rpm -qa | wc -l
# 현재 다운받은 패키지가 몇개인지 볼 때
``` 

네트워크 설정
확인 :
ip  :ip addr
gw :ip route
DNS cat /etc/resolv.conf
설정
nmtui
nm-connection-editor
nmcli CMD

redirection : <, >, >>, 2>, 2>>
pipe symbol : |
ex. CMD | more
ex. CMD | grep root
ex. CMD | CMD | CMD ...

메타문자
- '', "", \, ``, ;

GOLD(복제용)

Bridge connection : OS 와 동일한 IP
Route connection : 인터넷 연결 가능
SCSI는 recommended로 설정
disc type = SCSI 타입
allocate 설정 건드리지 말기

win+e

퍼미션 
프로세스 관리

복제시 이름과 아이피변경

nmtui로 서버 이름 바꿔주기

kvm = vmware안의 vmware 
kvm을 없애는게 나음 왜냐? 너무 무거워짐
gnome-tweaks gnome 설정 명령어

su(= 일반 사용자끼리 사용가능하도록 하는게 나음)
sudo CMD ( su와 비슷한 거)
root 암호를 공유할 필요 없이 루트 권한 시행가능
사용자가 관리자 권한으로 수행하는 사용할 수 있는 명령어의 제한을 둘 수 있다
sudo -l [sudo 리스트]
sudo -i (sudo -root과 비슷)

에러 시
usermod -aG wheel fedora (관리자 권한 추가로 바꾸기)
useradd -G wheel fedora (관리자 한 추가하면서 생성)

쿠베네티스 쪽, 개발 쪽으로 치중되어 잇어서 그 쪽으로 보면 될듯

cmd | tee file.log == cmd > file.log
tee라는 명령어는 앞의 명령어를 뒤에 쓴
모니터에 출력 및 파일에도 저장되게 하려면 tee 명령어를 쓰면 된다.
tee file.log = >
tee -a

sudo 문제점
일반 사용자는 명령어 외에는 폴더를 만들수 없음
ex. sudo echo WEB > /var/www/html/index.html
에서 문제가 생김 리다이렉션 기호 뒤를 할 수 없음
==> echo WEB page | sudo tee -a /var/www/html/index.html
==> sudo vi /var/www/html/index.html
해결!

ls -l file1
-:rw-:r--:r--: 1 :root root: 0 : 1월 30 02:52 : file1
파일타입 : 유저의 권한 : 같은 그룹의 권한 : 아예다른 사용자 : 하드링크 카운트 : 소유자 : 그룹 : 크기 : 시간(mtime=modified time) : 이름
ln 명령어로 링크 카운트를 늘려줄 수 있음

chown -R -> 경로와 그 하위 파일들을 모두 바꿔준다
chown user.group == chwon user:group

chgrp CMD

chmod CMD
심볼릭 모드(symbolic), 옥탈모드(octal)
심볼릭 모드는 문자로 옥탈모드는 숫자로

find . -ls 현재 위치 모든 설정을 보여줌

파일과 디렉토리의 권한
디렉토리는 실행 권한은 꼭 가지고 있어야한다.
w권한을 실행하려면 x권한을 가지고 있어야한다.

id로 uid, gid, 그룹을 확인해봐

지우기를 못하면 생성도 불가

실무에서 권한 응용 예
1) 실행 권한 (ex: /bin/ls, $HOME/bin/scripts.sh)
읽지는 못하지만 실행은 가능하게 읽고 수정은 가능하지만 실행은 못하게d
2) 읽기 권한 웹사용자가 웹페이지 읽기
systemctl enable --now httpd
<alt +F4>
3) 보안 퍼미션 조정


umask는 서버에서 바꾸면 안됨
기본 체계를 스면 된다.
umask는 관리자가 변경하면 안됨
그냥 기본 퍼미션을 조정하는 값이다.

명령어로 바꾼 거는 현재 창에만 적용 영구적으로 하고 싶으면 환경파일로 들어가야함

bashrc환경파일에 umask 내용이 있는데 보통 관리자: 022, 일반사용자:002로 씀

bash 기능 확장
zsh 쉘 기능
shell prompt color
syntax highlighting
autosuggestion(history)

/etc/profile에는 시스템적으로 건드는 설정(로그인할 때)
~/.bash_profile 설정하고 한번만
~/.bashrc는 배쉬가 실행될때만 실행
~/.bash_logout 로그아웃할 때 읽어짐

환경화일 분석
if ~~ then
~~ : 조건

sh.local 사용자 추가 파일

~/.bash_profile

/etc/profile
$HOME/.bash_profile
$HOME/.bashrc
변수 설정
앨리어스
쉘 자체의 기능
기타(아무거나)등등이 환경파일에 들어갈 수 있다.
어떤 환경 파일을 설정해야할까
--> 관리자 : /etc/profile
--> 사용자 : $HOME/.bashrc
중요도에 따라 순서가 달라진다.전역 설정 : 변수의 재정의
맨 마지막에 읽어드리는 파일에 따라 변수의 값이 달라질 수 있기 대문에 맨 마지막에 읽어드리는 파일에 넣는게 좋음 환경설정은 한곳에 몰아넣는것이 좋음
사용자가 어차피 설정을 하기 대문에 관리자는 필요한 설정만 하는 것이 좋음

밑에 다가 정의하기~

환경 설정
$1 = 첫번째 인자변수(해당 명령어 뒤에 나오는 바로 다음 인자)
명령어를 짧게 줄이거나 애칭을 정할 때 많이 씀
접속을 달리하면 헷갈릴 수 있음 따라서 명령어를 바꿔서 해주면 좋다~
오타나는 명령어 또한 alias로 바꿔주면 좋다

서버에서 alias 중 반드시 들어가야하는 것
웹서버의 경우
주설정 파일, 소스 디렉토리, 로그디렉토리를 자주 쓴다
--> 이러한 파일들을 명령어 처리 해주면 더욱 쉽고 간편하게 일을 할 수 있다.

로그파일을 건들 때도 씀
로그파일 같은 경우는 날짜가 매번 바뀌고 변경이 되면 안되기 때문에 이름을 고정해서 alias를 걸어두거나 하면 안되기 때문에 view로 tail -f /log/file_`date +%m%d`.log로 할 수 있음
혹은 `date -d '1 days age' +%m%d`로 할 수 도 있음


-프로세서 정보
프로세서 = CPU 
프로세스 = program
PID (프로세서 식별번호)
PPID (부모 프로세서 식별번호)
bash쉘에 bash를 하나 더 가져올 수 잇음 그러면 두 개의 bash shell은 부모관계를 가짐
PID는 컴퓨터 마다 다름 
pstree(모든 프로세서의 부모 프로세서)
/proc/PID/*에는 프로세서의 정보들을 모두 저장해두고 있다
	**데몬 : 시스템을 위해 백그라운드에서 동작하는 프로세서
정보가 들어가있는 폴더 
ls /proc

-프로세서 관리
IT에서 관리 : 생성, 확인, 변경, 삭제를 포함하고 있음
명령어 뒤에 & 하나 붙이면 백그라운드 형태로 할 수 있음(명령어를 계속 쓸 수 잇다)
/root/bin/gather.sh | /root/bin/backup.sh 혹은 gedit, gnome-tweaks 등등 gui프로그램을 사용시 쓸 수 있다

->실행
fg CMD
bg CMD & ==> 오랜시간 가동해야하는 프로그램이나 gui환경 프로그램이 있을 때 사용함
->확인
ps
ps -l / ps -f 
ps -f는 뒤에 옵션값을 다 보여줌 벗 -l옵션은 보여주지 않음
ps -e 
실행되는 모든 프로세스를 보여주나 정보는 간략하게 보여줌
보통 ps -ef를 많이 씀
ps aux
ps a => 가상 콘솔을 보여줌
	가상 콘솔은 보통 6개정도 제공됨 
tty == 콘솔 번호
pts == 터미널 번호 ?????
ps a
사용자가 로그인을 했을 때 실행되는 프로세서
ps u
간략히
ps x
모든 프로세서(데몬)
----> ps aux
ps -t pts/5
->종료
	**job 관리(실행중인거)
	 fg vs bg >> bg jobs를 fg로 보내는 법 fg (number) 
		* job 실행 : CMD or CMD &
		* job 확인 : jobs
		* job 종료 : kill %1 ( or ctrl C)
zombie processor
닫았으나 닫히지 않은 프로세스
검색시 defunct라고 나옴 == zombie processor
프로세서 종료시 kill PIDnum을 쓴다
kill -15(-TERM) == kill PID ==정상종료
kill -9 == 강제종료
kill -l == kill 시그널 리스트 보기
kill PID (kill PIDnum)
killall httpd (killall name)
pkill httpd (pkill name)
------------------------+
**프로세서 모니터링** |
------------------------+
top 명령 (ps와 같은 명령어)
자원 모니터링과 로그 모니터링
자원 모니터링의 밑바탕 네가지(CPU, MEMORY, DISK, NETWORK) 기본적으로 모니터링해야하는것
벗 top은 cpu와 memory만 한다.
-> top = gnome-system-monitor
top -u username(사용자)
top -p PID1,PID2,PID3
-> tail -f /var/log/messages = gnome-logs

top -d sec -n max -u|U

*****top 명령어의 정렬을 할 때 사용하는 기본
sort : c*P*u, *M*emory =>> 네트워크가 IO같은 건 다른 툴을 사용하여 봐야함
메모리가 증가추이에 있으면 언젠가 꽉찬다는 소리이기 때문에 좋지 않은 신호임
메모리가 늘어나면 swap 공간 사용량이 늘어남
최소 일주일간의 증가추이를 판단해야 이것이 위험한지 안 위험한지 알 수 있음
어떤 프로세서가 범인인지 알려줌

lscpu -e 현재 코어 개수 
sleep 상태 : 대기 상태
ps -elf | awk '$2 == "Z" {print $0}'
80%이상 사용량이 감지되면 cpu 사용량이 부족한 것임
free vs buff/cache 캐싱되어있는 공간
캐싱? 검색이력같은거.... 얘도 남는 공간 중 하나임(캐싱공간이 많을수록 성능이 우수해짐)

atop은 네가지 모두 다 보여주고 수집가능( = 그래프로 보여줌)
atop 가이드 보기

btop cpu나 메모리, 디스크, 네트워크나 프로세서에 관한 정보가 나온다.
서비스를 볼 수 있음
	https://www.digitalocean.com/community/tutorials/atop-command-in-linux
	https://m.blog.naver.com/godjaeseung/221094002995

서버에 프로그램 설치하는 건 어렵기 때문에 최대한 있는 툴을 가지고 커버를 하는 것이 좋음
top -u oracle(계정)
정렬은 top 들어가서 S누르고 P M
종료 k -> PID -> signal -> <ENTER>
기타 모니터링 툴(CPU/MEM/DISK/NET I/O)
top/htop
iotop
atop(수집용도)
btop(모니터링 용도)
참고>> atop Guide 꼭 보기

어떤 it든 자원 모니터링이든 로그 모니터링이 잇다 이를 잘 알아두길!

원격접속(telnet, ssh) 

파일전송(ftp, sftp, scp)
scp는 cp 명령어와 icp명령어를 모델로 하여 나옴(cp는 로컬 <> 로컬로 파일전송.)ㄴㄴ
> scp는 원격으로 가능

cp 명령어 처럼 디렉토리 복사할 때는 -r옵션이 반드시! 있어야한다

하나의 데몬으로 세가지 프로토콜!(ssh, sftp,scp)

/etc/hosts파일은
도메인 이름과 ip를 매핑하는 역할을 가진다. 작은 네트워크안의 서버들에서 dns서버를 대신할 수 잇다.
보통 
[아이피] [이름] [별칭] => 이름과 ip들을 매핑하게 해줌
scp [-r 디렉토리 옮길 때] [-P(포트번호 지정 옵션)] {보낼 파일 경로} {사용자@IP:받을경로}

ssh (name) ls -l /tmp/{server*,Cent*}

ssh ip 'CMD';'CMD'

암호화 통신 : ssh / 암호화 통신 X : telnet

공개키 인증 방식
실무예: 암호입력없이 ssh/scp CMD 명령어 수행하기
키를 잘 관리하는 것이 보안상 굉장히 유리함

private key를 가지고 public key를 만든다.
암호화하려면 복호화 키가 필요하고 
RSA 방식 공개키 암호화 방식 : private key를 사용하여 암호를 만들고 public key로 복호하
DSA 방식 공개키 서명 방식 : 

키생성
내 키 전송
private -> pub 단방향