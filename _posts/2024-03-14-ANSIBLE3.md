---
title: Ansible(3)
date: 2024-03-12 09:00:00 +09:00
categories: [IT, ansible]
tags: [linux, 기초, ansible, centos]		# TAG는 반드시 소문자로 이루어져야함!
---
# 제어 구문 - job control

## 반복문과 조건문
### 반복문
1. 단순 반복문(loop, <span style="background-color:yellow">with_items</span>)

2. 중첩 반복문(with_nested)

3. 기타 일반 반복 지시문
    - with_file
    - with_fileglob
    - with_random_choice

- ***변수는 키-값 형식으로 정의해야 한다.***
- ***반복문에서 사용되는 변수는 목록 형식이어야 한다.***  

```yml    
    ...: {{item}}  
    with_items:  
        - value2
        - value2
```
### 조건문
- when 구문

- when 구문 조건 예제
    - ansible_machine == "x86_64"
    - max_memory == 512
    - min_memory != 512
    - min_memory < 128
    - min_memory >= 512
    - min_memory is defined
    - max_memory is not defined
    - memory_available
    - note memory_available
    - my_special_user in superusers

- when 구문 예제
    - 둘중 한가지 조건이 만족하면 참

    > when: ansible_distribution == "RedHat" or ansible_distribution == "Fedora"

    - 두개의 조건이 모두 만족하면 참
    >when: ansible_distribution_version == "7.5" and ansible_kernel == "3.10.0-327.el7.x86_64"
    >when:  
    > \- ansible_distribution_version == "7.5"  
    > \- ansible_kernel == "3.10.0-327.el7.x86_64"  
    - 여러가지 조건인 경우
    >    when:  
    >  ( ansible_distribution == "RedHat" and  
    >    ansible_distribution_major_version == "7" )  
    >  or  
    >  ( ansible_distribution == "Fedora" and  
    >    ansible_distribution_major_version == "28" )  

<center>(중요) when 구문의 조건에서 사용되는 형식이 jinja2형식이다. </center> 
<center>when 구문안에 조건에서 변수는 중괄호({{변수}})를 표시하지 않는다.</center>
    
- 반복문 + 조건문
```yml
---
- name: Restart HTTPD if Postfix is Running
  hosts: all
  tasks:
    - name: Get Postfix server stauts
      # postfix가 실행 중인지 확인
      command: /usr/bin/systemctl is-active postfix
      # 실행 중이 아니면, 명령이 실패하더라도 처리를 중지하지 않는다.
      ignore_errors: yes
      # 모듈 결과에 대한 정보를 result 변수에 저장한다.
      register: result

    - name: Restart Aapache HTTPD based on Postfix status
      service:
        name: httpd
        state: restarted
      # postfix 작업 출력을 평가한다. postfix 서비스가 동작 중인 경우에만 httpd 서비스
      # 가 재 기동 된다.
      when: result.rc == 0
```

## 핸들러 구현

## 작업 오류 처리

## 태그 구현

