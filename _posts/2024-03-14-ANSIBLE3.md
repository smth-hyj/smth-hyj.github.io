---
title: Ansible(3)
date: 2024-03-12 09:00:00 +09:00
categories: [IT, ansible]
tags: [linux, 기초, ansible, centos]		# TAG는 반드시 소문자로 이루어져야함!
---
# 제어 구문 - job control

## 반복문과 조건문
### 반복문
1. 단순 반복문(loop, <span style="background-color:yellow">with_items</span>)

2. 중첩 반복문(with_nested)

3. 기타 일반 반복 지시문
    - with_file
    - with_fileglob
    - with_random_choice

- ***변수는 키-값 형식으로 정의해야 한다.***
- ***반복문에서 사용되는 변수는 목록 형식이어야 한다.***  

```yml    
    ...: {{item}}          ...: {{item.k1}}
    with_items:            with_items:
        - value2              - v1: k1
        - value2              - v2: k2
```
### 조건문
- when 구문

- when 구문 조건 예제
    - ansible_machine == "x86_64"
    - max_memory == 512
    - min_memory != 512
    - min_memory < 128
    - min_memory >= 512
    - min_memory is defined
    - max_memory is not defined
    - memory_available
    - note memory_available
    - my_special_user in superusers

- when 구문 예제
    - 둘중 한가지 조건이 만족하면 참

    > when: ansible_distribution == "RedHat" or ansible_distribution == "Fedora"

    - 두개의 조건이 모두 만족하면 참

    >when: ansible_distribution_version == "7.5" and ansible_kernel == "3.10.0-327.el7.x86_64"
    >when:  
    > \- ansible_distribution_version == "7.5"  
    > \- ansible_kernel == "3.10.0-327.el7.x86_64"  

    - 여러가지 조건인 경우

    >    when:  
    >  ( ansible_distribution == "RedHat" and  
    >    ansible_distribution_major_version == "7" )  
    >  or  
    >  ( ansible_distribution == "Fedora" and  
    >    ansible_distribution_major_version == "28" )  

<center>(중요) when 구문의 조건에서 사용되는 형식이 jinja2형식이다. </center> 
<center>when 구문안에 조건에서 변수는 중괄호({{변수}})를 표시하지 않는다.</center>
    
- 반복문 + 조건문

```yml
---
- name: install mariadb-server if enough space on root
  yum:
    name: mariadb-server
    state: latest
  with_items: "{{ ansible_mounts }}"
  when: item.mount == "/" and item.size_available > 300000000
```

## 핸들러 구현
### 핸들러
Ansible은 역등성이 보장되도록 설계됐는데, 

## 작업 오류 처리

## 태그 구현

