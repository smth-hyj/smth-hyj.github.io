---
title: Ansible(2)
date: 2024-03-12 09:00:00 +09:00
categories: [IT, ansible]
tags: [linux, 기초, ansible, centos]		# TAG는 반드시 소문자로 이루어져야함!
---
웹서비스를 설치하고 데이터 베이스를 설치하고 설정하는 실습을 진행한다.


개발자가 알아ㅓㅅ 하게 최소한의 것만 보안상 해준다.

## Ansible PlayBook
1. Ansible Playbook 작성
- vi playbook.yml
```yml
---
- name: play1
  hosts: web1
  tasks: 
    - name: task1
      yum:
        option1: ...
        option2: ...
    - name: task2
      service:
        option1: ...
        option2: ...
```

- 플레이북 실행
    - ansible-playbook playbook.yml
    - ansible-playbook --syntax-check playbook.yml
    - ansible-playbook -C playbook.yml

2. 다중 플레이 구현
- vi playbook.yml
```yml
--- 
- name: play1
  hosts: web1
  tasks:
    - name: task1

- name: play2
  hosts: web2
  become: true
  become_method: sudo
  become_user: devops
  tasks:
    - name: task1
```

3. **Play 기동시 사용자 권한 상승**
- ansible.cfg에 넣으면 모든 사용자가 해당 권한을 갖음
- playbook에 설정하면 각각 설정 가능함

# Ansible 변수 & 시크릿 & 팩트
## 변수
1. 변수 이름 지정
    - 변수 이름은 문자, 숫자, 밑줄(_)이 가능하다
    - 변수 이름은 문자로 시작해야한다
2. 변수 적용 범위
    - 변수 적용 범위(좁은 범위가 넓은 범위보다 우선한다)
      1. 전역 범위
          - ex. "ansible -e..."
      2. 플레이 범위
          - ex. play.yml(vars, vars_files)
      3. 호스트 범위
          - ex. "host_vars/*"
      4. 그룹 변수
          - ex. "group_vars/*"
3. 플레이 북에서 변수 정의
    - 변수 정의
      - 플레이북내에 변수를 지정하는 경우
      - 별도의 파일로 변수를 설정하고 플레이북에서 지정하는 경우
      ```yml
      $ cat vars/users.yml    #변수 파일 
      --- 
      user: user01
      hoem: /home/user01
      ...
      $ cat site.yml
      ---
      - hosts: web1
        vars_files:           # 변수 파일 실행
          - vars/users.yml
      ```
    - 변수 사용
      - 변수의 사용은 "{{ variable }}" 형식으로 사용한다.

|BASH shell env|Ansible env|
|:-------------:|------------|
|$ variable=hello|- hosts: web1
|                 |   vars:|
|                 |       variable1: hello|
|$ echo \$(username)| tasks:|
||- name: Task1|
||  user:|
||name: "{{ username }}"|

## 시크릿


## 팩트

